barplot(t(neg_shrunk_u), col=2:3, add=TRUE)
ss_loadings <- apply(shrunk_u,1,function(x) return(sqrt(sum(x^2))))
which(ss_loadings > 1e-03)
256/4
64*3
64*2
library(cellcycleR)
G <- 256;
num_cells <- 100;
amp_genes <- c(rep(10, G/4), rep(2,G/4), rep(0,G/4), rep(0.5,G/4));
phi_genes <- runif(G, 0, 2*pi)
sigma_genes <- rchisq(G, 2);
cell_times_sim <- sort(sample(seq(0,2*pi, 2*pi/(num_cells-1)), num_cells, replace=FALSE));
cycle_data <- sim_sinusoidal_cycle(G, amp_genes, phi_genes, sigma_genes, cell_times_sim);
dim(cycle_data)
library(cellcycleR)
G <- 100;
num_cells <- 256;
amp_genes <- c(rep(10, G/4), rep(2,G/4), rep(0,G/4), rep(0.5,G/4));
phi_genes <- runif(G, 0, 2*pi)
sigma_genes <- rchisq(G, 2);
cell_times_sim <- sort(sample(seq(0,2*pi, 2*pi/(num_cells-1)), num_cells, replace=FALSE));
cycle_data <- sim_sinusoidal_cycle(G, amp_genes, phi_genes, sigma_genes, cell_times_sim);
library(wavethresh)
wave_data <- t(apply(cycle_data, 1, function(x)
{
out <- wd(x, filter.number = 3, family = "DaubExPhase")
return(out$D)
}));
cycle_data <- t(sim_sinusoidal_cycle(G, amp_genes, phi_genes, sigma_genes, cell_times_sim));
library(wavethresh)
wave_data <- t(apply(cycle_data, 1, function(x)
{
out <- wd(x, filter.number = 3, family = "DaubExPhase")
return(out$D)
}));
dim(wave_data)
data_norm1 <- apply(wave_data,2,function(x) return(x-mean(x)));
data_norm2 <- apply(data_norm1, 1, function(x) return(x-mean(x)));
dim(data_norm2)
library(PMA)
pmd1 <- PMD(data_norm2, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
apply(pmd1$u,2,function(x) return(sqrt(sum(x^2))))
library(ashr)
shrunk_u <- suppressWarnings(apply(pmd1$u, 2, function(x) return(ash(x,sqrt(1/length(x)))$PosteriorMean)));
pos_shrunk_u <- apply(shrunk_u, c(1,2), function(x) return (max(x,0)))
neg_shrunk_u <- apply(shrunk_u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_shrunk_u), col=2:3)
barplot(t(neg_shrunk_u), col=2:3, add=TRUE)
ss_loadings <- apply(shrunk_u,1,function(x) return(sqrt(sum(x^2))))
which(ss_loadings > 1e-03)
dim(cycle_data)
plot(cycle_data[,1])
plot(cycle_data[,1],type="l")
plot(cycle_data[1,],type="l")
library(wavethresh)
wave_data <- t(apply(cycle_data, 1, function(x)
{
out <- wd(x, filter.number = 3, family = "DaubExPhase")
return(out$D)
}));
dim(wave_data)
data_norm2 <- wave_data
library(PMA)
pmd1 <- PMD(data_norm2, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
library(cellcycleR)
G <- 100;
num_cells <- 256;
amp_genes <- c(rep(10, G/4), rep(2,G/4), rep(0,G/4), rep(0.5,G/4));
phi_genes <- runif(G, 0, 2*pi)
sigma_genes <- rchisq(G, 2);
cell_times_sim <- sort(sample(seq(0,2*pi, 2*pi/(num_cells-1)), num_cells, replace=FALSE));
cycle_data <- t(sim_sinusoidal_cycle(G, amp_genes, phi_genes, sigma_genes, cell_times_sim));
library(wavethresh)
wave_data <- t(apply(cycle_data, 1, function(x)
{
out <- wd(x, filter.number = 3, family = "DaubExPhase")
return(out$D)
}));
data_norm2 <- wave_data
pmd1 <- PMD(data_norm2, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
apply(pmd1$u,2,function(x) return(sqrt(sum(x^2))))
library(ashr)
shrunk_u <- suppressWarnings(apply(pmd1$u, 2, function(x) return(ash(x,sqrt(1/length(x)))$PosteriorMean)));
pos_shrunk_u <- apply(shrunk_u, c(1,2), function(x) return (max(x,0)))
neg_shrunk_u <- apply(shrunk_u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_shrunk_u), col=2:3)
barplot(t(neg_shrunk_u), col=2:3, add=TRUE)
ss_loadings <- apply(shrunk_u,1,function(x) return(sqrt(sum(x^2))))
which(ss_loadings > 1e-03)
library(cellcycleR)
G <- 100;
num_cells <- 256;
amp_genes <- c(rep(10, G/4), rep(2,G/4), rep(0,G/4), rep(0.5,G/4));
phi_genes <- runif(G, 0, 2*pi)
sigma_genes <- rchisq(G, 2);
cell_times_sim <- sort(sample(seq(0,2*pi, 2*pi/(num_cells-1)), num_cells, replace=FALSE));
cycle_data <- t(sim_sinusoidal_cycle(G, amp_genes, phi_genes, sigma_genes, cell_times_sim));
library(wavethresh)
wave_data <- t(apply(cycle_data, 1, function(x)
{
out <- wd(x, filter.number = 3, family = "DaubExPhase")
return(out$D)
}));
data_norm1 <- apply(wave_data,2,function(x) return(x-mean(x)));
data_norm2 <- apply(data_norm1, 1, function(x) return(x-mean(x)));
pmd1 <- PMD(data_norm2, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
dim(cycle_data)
dim(data_norm2)
data_norm2 <- t(cycle_data)
pmd1 <- PMD(data_norm2, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
dim(cycle_data)
wave_data <- cycle_data
data_norm1 <- apply(wave_data,2,function(x) return(x-mean(x)));
data_norm2 <- apply(data_norm1, 1, function(x) return(x-mean(x)));
pmd1 <- PMD(data_norm2, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
library(cellcycleR)
G <- 100;
num_cells <- 256;
amp_genes <- c(rep(10, G/4), rep(2,G/4), rep(0,G/4), rep(0.5,G/4));
phi_genes <- runif(G, 0, 2*pi)
sigma_genes <- rchisq(G, 2);
cell_times_sim <- sort(sample(seq(0,2*pi, 2*pi/(num_cells-1)), num_cells, replace=FALSE));
cycle_data <- t(sim_sinusoidal_cycle(G, amp_genes, phi_genes, sigma_genes, cell_times_sim));
data_norm1 <- apply(cycle_data,2,function(x) return(x-mean(x)));
data_norm2 <- apply(data_norm1, 1, function(x) return(x-mean(x)));
dim(data_norm2)
pmd1 <- PMD(data_norm2, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
data_norm2 <- t(apply(data_norm1, 1, function(x) return(x-mean(x))));
pmd1 <- PMD(data_norm2, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
library(PMA)
library(cellcycleR)
library(wavethresh)
G <- 100;
num_cells <- 256;
amp_genes1 <- c(rep(10, G/4), rep(5, G/4), rep(0,G/4), rep(0.5,G/4));
phi_genes1 <- rep(c(2,5), each=G/2);
sigma_genes1 <- rchisq(G, 4);
cell_times_sim <- sort(sample(seq(0,2*pi, 2*pi/(num_cells-1)), num_cells, replace=FALSE));
cycle_data <- t(sim_sinusoidal_cycle(G, amp_genes1, phi_genes1, sigma_genes1, cell_times_sim));
plot(cycle_data[2,], type="l");
plot(cycle_data[(2+(G/2)),], type="l")
wave_data <- t(apply(cycle_data, 1, function(x)
{
out <- wd(x, filter.number = 3, family = "DaubExPhase")
return(out$D)
}));
library(PMA)
pmd1 <- PMD(wave_data, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
dim(pos_u)
library(PMA)
library(cellcycleR)
library(wavethresh)
G <- 100;
num_cells <- 256;
amp_genes1 <- c(rep(10, G/4), rep(5, G/4), rep(0,G/4), rep(3,G/4));
phi_genes1 <- rep(c(2,5), each=G/2);
sigma_genes1 <- rchisq(G, 4);
cell_times_sim <- sort(sample(seq(0,2*pi, 2*pi/(num_cells-1)), num_cells, replace=FALSE));
cycle_data <- t(sim_sinusoidal_cycle(G, amp_genes1, phi_genes1, sigma_genes1, cell_times_sim));
plot(cycle_data[2,], type="l");
```
plot(cycle_data[(2+(G/2)),], type="l")
wave_data <- t(apply(cycle_data, 1, function(x)
{
out <- wd(x, filter.number = 3, family = "DaubExPhase")
return(out$D)
}));
pmd1 <- PMD(wave_data, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
library(PMA)
library(cellcycleR)
library(wavethresh)
G <- 100;
num_cells <- 256;
amp_genes1 <- c(rep(10, G/4), rep(5, G/4), rep(0,G/4), rep(3,G/4));
phi_genes1 <- rep(c(2,5), each=G/2);
sigma_genes1 <- rchisq(G, 2);
cell_times_sim <- sort(sample(seq(0,2*pi, 2*pi/(num_cells-1)), num_cells, replace=FALSE));
cycle_data <- t(sim_sinusoidal_cycle(G, amp_genes1, phi_genes1, sigma_genes1, cell_times_sim));
plot(cycle_data[2,], type="l");
plot(cycle_data[(2+(G/2)),], type="l")
wave_data <- t(apply(cycle_data, 1, function(x)
{
out <- wd(x, filter.number = 3, family = "DaubExPhase")
return(out$D)
}));
pmd1 <- PMD(wave_data, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
library(PMA)
library(cellcycleR)
library(wavethresh)
G <- 100;
num_cells <- 256;
amp_genes1 <- c(rep(10, G/4), rep(5, G/4), rep(0,G/4), rep(6,G/4));
phi_genes1 <- rep(c(2,5), each=G/2);
sigma_genes1 <- rchisq(G, 2);
cell_times_sim <- sort(sample(seq(0,2*pi, 2*pi/(num_cells-1)), num_cells, replace=FALSE));
cycle_data <- t(sim_sinusoidal_cycle(G, amp_genes1, phi_genes1, sigma_genes1, cell_times_sim));
plot(cycle_data[2,], type="l");
plot(cycle_data[(2+(G/2)),], type="l")
wave_data <- t(apply(cycle_data, 1, function(x)
{
out <- wd(x, filter.number = 3, family = "DaubExPhase")
return(out$D)
}));
pmd1 <- PMD(wave_data, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
library(PMA)
library(cellcycleR)
library(wavethresh)
G <- 100;
num_cells <- 256;
amp_genes1 <- c(rep(10, G/4), rep(6, G/4), rep(0,G/4), rep(6,G/4));
phi_genes1 <- rep(c(2,5), each=G/2);
sigma_genes1 <- rchisq(G, 2);
cell_times_sim <- sort(sample(seq(0,2*pi, 2*pi/(num_cells-1)), num_cells, replace=FALSE));
cycle_data <- t(sim_sinusoidal_cycle(G, amp_genes1, phi_genes1, sigma_genes1, cell_times_sim));
plot(cycle_data[2,], type="l");
plot(cycle_data[(2+(G/2)),], type="l")
wave_data <- t(apply(cycle_data, 1, function(x)
{
out <- wd(x, filter.number = 3, family = "DaubExPhase")
return(out$D)
}));
pmd1 <- PMD(wave_data, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
library(PMA)
library(cellcycleR)
library(wavethresh)
G <- 100;
num_cells <- 256;
amp_genes1 <- c(rep(8, G/4), rep(6, G/4), rep(0,G/4), rep(6,G/4));
phi_genes1 <- rep(c(2,5), each=G/2);
sigma_genes1 <- rchisq(G, 2);
cell_times_sim <- sort(sample(seq(0,2*pi, 2*pi/(num_cells-1)), num_cells, replace=FALSE));
cycle_data <- t(sim_sinusoidal_cycle(G, amp_genes1, phi_genes1, sigma_genes1, cell_times_sim));
plot(cycle_data[2,], type="l");
plot(cycle_data[(2+(G/2)),], type="l")
wave_data <- t(apply(cycle_data, 1, function(x)
{
out <- wd(x, filter.number = 3, family = "DaubExPhase")
return(out$D)
}));
pmd1 <- PMD(wave_data, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
apply(pmd1$u,2,function(x) return(sqrt(sum(x^2))))
library(ashr)
shrunk_u <- suppressWarnings(apply(pmd1$u, 2, function(x) return(ash(x,sqrt(1/length(x)))$PosteriorMean)));
pos_shrunk_u <- apply(shrunk_u, c(1,2), function(x) return (max(x,0)))
neg_shrunk_u <- apply(shrunk_u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_shrunk_u), col=2:3)
barplot(t(neg_shrunk_u), col=2:3, add=TRUE)
y
ss_loadings <- apply(shrunk_u,1,function(x) return(sqrt(sum(x^2))))
which(ss_loadings > 1e-03)
which(ss_loadings > 1e-04)
which(ss_loadings > 1e-06)
which(ss_loadings > 1e-04)
dim(wave_data)
dim(cycle_data)
pmd1 <- PMD(cycle_data, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
apply(pmd1$u,2,function(x) return(sqrt(sum(x^2))))
library(ashr)
shrunk_u <- suppressWarnings(apply(pmd1$u, 2, function(x) return(ash(x,sqrt(1/length(x)))$PosteriorMean)));
pos_shrunk_u <- apply(shrunk_u, c(1,2), function(x) return (max(x,0)))
neg_shrunk_u <- apply(shrunk_u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_shrunk_u), col=2:3)
barplot(t(neg_shrunk_u), col=2:3, add=TRUE)
ss_loadings <- apply(shrunk_u,1,function(x) return(sqrt(sum(x^2))))
which(ss_loadings > 1e-06)
which(ss_loadings > 1e-04)
which(ss_loadings > 1e-03)
data=read.csv("../external_data/Himalayan_grid_matrix.csv",header=TRUE);
counts=as.matrix(data[,-1]);
rownames(counts)=data[,1];
new_data1 <- data.frame(read.csv('../external_data/MohanGrids.csv'));
new_data2 <- data.frame(read.csv('../external_data/MohanGrids2.csv'));
bird_species <- union(as.vector(colnames(counts)), union(as.vector(new_data1[,1]), as.vector(new_data2[,1])));
new_data <- matrix(0,dim(counts)[1]+3,length(bird_species));
new_data[1,match(new_data1[,1],bird_species)]=new_data1[,2];
new_data[2,match(new_data1[,1],bird_species)]=new_data1[,3];
new_data[3,match(new_data2[,1],bird_species)]=new_data2[,2];
new_data[4:(dim(counts)[1]+3),match(colnames(counts),bird_species)]=counts;
new_counts <- as.matrix(new_data);
rownames(new_counts) <- c(c("U1","U2","MA1"),rownames(counts));
colnames(new_counts) <- bird_species;
setwd('/Users/kushal/Documents/wave-sfa/project/src/')
data=read.csv("../external_data/Himalayan_grid_matrix.csv",header=TRUE);
counts=as.matrix(data[,-1]);
rownames(counts)=data[,1];
new_data1 <- data.frame(read.csv('../external_data/MohanGrids.csv'));
new_data2 <- data.frame(read.csv('../external_data/MohanGrids2.csv'));
bird_species <- union(as.vector(colnames(counts)), union(as.vector(new_data1[,1]), as.vector(new_data2[,1])));
new_data <- matrix(0,dim(counts)[1]+3,length(bird_species));
new_data[1,match(new_data1[,1],bird_species)]=new_data1[,2];
new_data[2,match(new_data1[,1],bird_species)]=new_data1[,3];
new_data[3,match(new_data2[,1],bird_species)]=new_data2[,2];
new_data[4:(dim(counts)[1]+3),match(colnames(counts),bird_species)]=counts;
new_counts <- as.matrix(new_data);
rownames(new_counts) <- c(c("U1","U2","MA1"),rownames(counts));
colnames(new_counts) <- bird_species;
dim(new_counts)
system.time(Topic_clus <- topics(new_counts, K=2,tol=0.01));
K=2
barplot(t(Topic_clus$omega[order(elevation_metadata),]),col=2:(K+1),axisnames=F,space=0,border=NA,main="",las=1,ylim=c(0,1),cex.axis=1.5,cex.main=1.4)
title(main=paste("Structure Plot topic proportions,k=",K))
combo_patch_dir = paste0(elevation_metadata,"_",east_west_dir);
combo_patch_dir_ordered = combo_patch_dir[order(elevation_metadata)];
match_labs=match(unique(combo_patch_dir_ordered),combo_patch_dir_ordered);
match_labs_suffix=c(match_labs[2:length(unique(combo_patch_dir_ordered))],35);
match_labs_prefix=match_labs[1:(length(unique(combo_patch_dir_ordered)))];
labs=match_labs_prefix + 0.5*(match_labs_suffix - match_labs_prefix);
axis(1,at=labs,unique(combo_patch_dir_ordered),las=2);
abline(v=match_labs[2:length(match_labs)]);
metadata=read.csv("../external_data/Himalayan_grid_metadata.csv",header=TRUE);
elevation_metadata=metadata$Elevation[match(rownames(padded_data[-(1:3),]),metadata[,1])];
east_west_dir = metadata$WorE[match(rownames(padded_data[-(1:3),]),metadata[,1])];
system.time(Topic_clus <- topics(new_counts, K=2,tol=0.01));
K=2
barplot(t(Topic_clus$omega[order(elevation_metadata),]),col=2:(K+1),axisnames=F,space=0,border=NA,main="",las=1,ylim=c(0,1),cex.axis=1.5,cex.main=1.4)
title(main=paste("Structure Plot topic proportions,k=",K))
combo_patch_dir = paste0(elevation_metadata,"_",east_west_dir);
combo_patch_dir_ordered = combo_patch_dir[order(elevation_metadata)];
match_labs=match(unique(combo_patch_dir_ordered),combo_patch_dir_ordered);
match_labs_suffix=c(match_labs[2:length(unique(combo_patch_dir_ordered))],35);
match_labs_prefix=match_labs[1:(length(unique(combo_patch_dir_ordered)))];
labs=match_labs_prefix + 0.5*(match_labs_suffix - match_labs_prefix);
axis(1,at=labs,unique(combo_patch_dir_ordered),las=2);
abline(v=match_labs[2:length(match_labs)]);
metadata=read.csv("../external_data/Himalayan_grid_metadata.csv",header=TRUE);
elevation_metadata=metadata$Elevation[match(rownames(padded_data[-(1:3),]),metadata[,1])];
data=read.csv("../external_data/Himalayan_grid_matrix.csv",header=TRUE);
counts=as.matrix(data[,-1]);
rownames(counts)=data[,1];
new_data1 <- data.frame(read.csv('../external_data/MohanGrids.csv'));
new_data2 <- data.frame(read.csv('../external_data/MohanGrids2.csv'));
bird_species <- union(as.vector(colnames(counts)), union(as.vector(new_data1[,1]), as.vector(new_data2[,1])));
new_data <- matrix(0,dim(counts)[1]+3,length(bird_species));
new_data[1,match(new_data1[,1],bird_species)]=new_data1[,2];
new_data[2,match(new_data1[,1],bird_species)]=new_data1[,3];
new_data[3,match(new_data2[,1],bird_species)]=new_data2[,2];
new_data[4:(dim(counts)[1]+3),match(colnames(counts),bird_species)]=counts;
new_counts <- as.matrix(new_data);
rownames(new_counts) <- c(c("U1","U2","MA1"),rownames(counts));
colnames(new_counts) <- bird_species;
new_counts <- new_counts[-(1:3),];
dim(new_counts)
metadata=read.csv("../external_data/Himalayan_grid_metadata.csv",header=TRUE);
elevation_metadata=metadata$Elevation[match(rownames(new_counts),metadata[,1])];
east_west_dir = metadata$WorE[match(rownames(new_counts),metadata[,1])];
east_west_dir
length(east_west_dir)
system.time(Topic_clus <- topics(new_counts, K=2,tol=0.01));
K=2
barplot(t(Topic_clus$omega[order(elevation_metadata),]),col=2:(K+1),axisnames=F,space=0,border=NA,main="",las=1,ylim=c(0,1),cex.axis=1.5,cex.main=1.4)
title(main=paste("Structure Plot topic proportions,k=",K))
combo_patch_dir = paste0(elevation_metadata,"_",east_west_dir);
combo_patch_dir_ordered = combo_patch_dir[order(elevation_metadata)];
match_labs=match(unique(combo_patch_dir_ordered),combo_patch_dir_ordered);
match_labs_suffix=c(match_labs[2:length(unique(combo_patch_dir_ordered))],35);
match_labs_prefix=match_labs[1:(length(unique(combo_patch_dir_ordered)))];
labs=match_labs_prefix + 0.5*(match_labs_suffix - match_labs_prefix);
axis(1,at=labs,unique(combo_patch_dir_ordered),las=2);
abline(v=match_labs[2:length(match_labs)]);
data_norm1 <- apply(new_counts,2,function(x) return(x-mean(x)));
data_norm2 <- apply(data_norm1, 1, function(x) return(x-mean(x)));
library(PMA)
pmd1 <- PMD(data_norm2, type="standard", K=2, niter=50);
pos_u <- apply(pmd1$u, c(1,2), function(x) return (max(x,0)))
neg_u <- apply(pmd1$u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_u), col=2:3)
barplot(t(neg_u), col=2:3, add=TRUE)
apply(pmd1$u,2,function(x) return(sqrt(sum(x^2))))
library(ashr)
shrunk_u <- suppressWarnings(apply(pmd1$u, 2, function(x) return(ash(x,sqrt(1/length(x)))$PosteriorMean)));
pos_shrunk_u <- apply(shrunk_u, c(1,2), function(x) return (max(x,0)))
neg_shrunk_u <- apply(shrunk_u, c(1,2), function(x) return (min(x,0)))
par(mar=c(12,2,2,1))
barplot(t(pos_shrunk_u), col=2:3)
barplot(t(neg_shrunk_u), col=2:3, add=TRUE)
ss_loadings <- apply(shrunk_u,1,function(x) return(sqrt(sum(x^2))))
which(ss_loadings > 1e-04)
vs_counts <- counts[,which(ss_loadings > 1e-03)];
system.time(Topic_clus <- topics(vs_counts, K=2,tol=0.001));
K <- 2;
barplot(t(Topic_clus$omega[order(elevation_metadata),]),col=2:(K+1),axisnames=F,space=0,border=NA,main="",las=1,ylim=c(0,1),cex.axis=1.5,cex.main=1.4)
title(main=paste("Structure Plot topic proportions,k=",K))
combo_patch_dir = paste0(elevation_metadata,"_",east_west_dir);
combo_patch_dir_ordered = combo_patch_dir[order(elevation_metadata)];
match_labs=match(unique(combo_patch_dir_ordered),combo_patch_dir_ordered);
match_labs_suffix=c(match_labs[2:length(unique(combo_patch_dir_ordered))],35);
match_labs_prefix=match_labs[1:(length(unique(combo_patch_dir_ordered)))];
labs=match_labs_prefix + 0.5*(match_labs_suffix - match_labs_prefix);
axis(1,at=labs,unique(combo_patch_dir_ordered),las=2);
abline(v=match_labs[2:length(match_labs)]);
dim(vs_counts)
system.time(Topic_clus <- topics(vs_counts, K=2,tol=0.01));
ss_loadings <- apply(shrunk_u,1,function(x) return(sqrt(sum(x^2))))
which(ss_loadings > 1e-06)
ss_loadings <- apply(shrunk_u,1,function(x) return(sqrt(sum(x^2))))
which(ss_loadings > 1e-05)
vs_counts <- counts[,which(ss_loadings > 1e-03)];
system.time(Topic_clus <- topics(vs_counts, K=2,tol=0.01));
K <- 2;
dim(vs_counts)
vs_counts <- counts[,which(ss_loadings > 1e-05)];
system.time(Topic_clus <- topics(vs_counts, K=2,tol=0.01));
vs_counts <- new_counts[,which(ss_loadings > 1e-05)];
system.time(Topic_clus <- topics(vs_counts, K=2,tol=0.01));
K <- 2;
barplot(t(Topic_clus$omega[order(elevation_metadata),]),col=2:(K+1),axisnames=F,space=0,border=NA,main="",las=1,ylim=c(0,1),cex.axis=1.5,cex.main=1.4)
title(main=paste("Structure Plot topic proportions,k=",K))
combo_patch_dir = paste0(elevation_metadata,"_",east_west_dir);
combo_patch_dir_ordered = combo_patch_dir[order(elevation_metadata)];
match_labs=match(unique(combo_patch_dir_ordered),combo_patch_dir_ordered);
match_labs_suffix=c(match_labs[2:length(unique(combo_patch_dir_ordered))],35);
match_labs_prefix=match_labs[1:(length(unique(combo_patch_dir_ordered)))];
labs=match_labs_prefix + 0.5*(match_labs_suffix - match_labs_prefix);
axis(1,at=labs,unique(combo_patch_dir_ordered),las=2);
abline(v=match_labs[2:length(match_labs)]);
ss_loadings <- apply(shrunk_u,1,function(x) return(sqrt(sum(x^2))))
which(ss_loadings > 1e-04)
vs_counts <- new_counts[,which(ss_loadings > 1e-05)];
system.time(Topic_clus <- topics(vs_counts, K=2,tol=0.01));
K <- 2;
barplot(t(Topic_clus$omega[order(elevation_metadata),]),col=2:(K+1),axisnames=F,space=0,border=NA,main="",las=1,ylim=c(0,1),cex.axis=1.5,cex.main=1.4)
title(main=paste("Structure Plot topic proportions,k=",K))
combo_patch_dir = paste0(elevation_metadata,"_",east_west_dir);
combo_patch_dir_ordered = combo_patch_dir[order(elevation_metadata)];
match_labs=match(unique(combo_patch_dir_ordered),combo_patch_dir_ordered);
match_labs_suffix=c(match_labs[2:length(unique(combo_patch_dir_ordered))],35);
match_labs_prefix=match_labs[1:(length(unique(combo_patch_dir_ordered)))];
labs=match_labs_prefix + 0.5*(match_labs_suffix - match_labs_prefix);
axis(1,at=labs,unique(combo_patch_dir_ordered),las=2);
abline(v=match_labs[2:length(match_labs)]);
Sys.info()[['sysname']]
